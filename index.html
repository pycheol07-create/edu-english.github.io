<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì˜¤ëŠ˜ì˜ ì˜ì–´ íšŒí™” íŒ¨í„´</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
        }
        .english-text {
            font-family: 'Inter', sans-serif;
        }
        /* ë¡œë”© ìŠ¤í”¼ë„ˆ ìŠ¤íƒ€ì¼ */
        .loader {
            border: 4px solid #f3f3f3;
            border-radius: 50%;
            border-top: 4px solid #3498db;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        /* TTS ì¬ìƒ ì¤‘ ì• ë‹ˆë©”ì´ì…˜ */
        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.2); opacity: 0.7; }
        }
        .tts-btn.is-playing svg {
            color: #3b82f6; /* Tailwind blue-500 */
            animation: pulse 1.5s ease-in-out infinite;
        }
    </style>
</head>
<body class="bg-gray-100">

    <div class="w-full max-w-3xl mx-auto p-4 md:p-8 py-8">
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-800 english-text">ğŸ‡ºğŸ‡¸ ì˜¤ëŠ˜ì˜ ì˜ì–´ íšŒí™” íŒ¨í„´ ğŸ‡ºğŸ‡¸</h1>
            <p id="current-date" class="text-gray-500 mt-2"></p>
        </header>

        <main id="pattern-container" class="space-y-6">
            <!-- ì˜ì–´ íŒ¨í„´ ì¹´ë“œê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤. -->
        </main>

        <footer class="text-center mt-8">
            <div class="flex justify-center items-center space-x-4">
                <button id="new-pattern-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg transition-colors duration-300 shadow-lg text-lg">
                    ìƒˆë¡œìš´ íŒ¨í„´ ë³´ê¸°
                </button>
                <button id="all-patterns-btn" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-6 rounded-lg transition-colors duration-300 shadow-lg text-lg">
                    ì „ì²´ íŒ¨í„´ ë³´ê¸°
                </button>
            </div>
            <p class="text-xs text-gray-400 mt-4">ë§¤ì¼ ìì •ì´ ì§€ë‚˜ë©´ ìƒˆë¡œìš´ íŒ¨í„´ì´ ìë™ìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤.</p>
            <p class="text-xs text-gray-400 mt-1">v.2025.10.17-7-en</p>
        </footer>
    </div>

    <!-- "ì´ë ‡ê²Œ ë§í•˜ê³  ì‹¶ì–´ìš”!" í”Œë¡œíŒ… ë²„íŠ¼ -->
    <button id="open-translator-btn" class="fixed bottom-6 right-6 bg-green-500 hover:bg-green-600 text-white font-bold rounded-full w-16 h-16 flex items-center justify-center shadow-xl transition-transform transform hover:scale-110">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-8 h-8">
          <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 21l5.25-11.25L21 21m-9-3h7.5M3 5.621a48.474 48.474 0 016-.371m0 0c1.12 0 2.233.038 3.334.114M9 5.25V3m3.334 2.364C13.18 7.061 14.287 7.5 15.5 7.5c1.213 0 2.32-.439 3.166-1.136m0 0V3m-3.166 2.864L18 2.25m-6 12C9.82 14.061 8.713 14.5 7.5 14.5c-1.213 0-2.32-.439-3.166-1.136m0 0V18m3.166-2.864L6 18.75" />
        </svg>
    </button>
    
    <!-- ë²ˆì—­ê¸° íŒì—… (ëª¨ë‹¬) -->
    <div id="translator-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-40">
        <div class="bg-white rounded-lg shadow-2xl w-full max-w-lg p-6 relative flex flex-col max-h-[90vh]">
            <div class="flex-shrink-0">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-bold text-gray-800">ì´ë ‡ê²Œ ë§í•˜ê³  ì‹¶ì–´ìš”!</h2>
                    <button id="close-translator-btn" class="p-1 rounded-full hover:bg-gray-200">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6 text-gray-600">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>
                <p class="text-gray-600 mb-4">ìì—°ìŠ¤ëŸ¬ìš´ ì›ì–´ë¯¼ í‘œí˜„ì´ ê¶ê¸ˆí•œ í•œêµ­ì–´ ë¬¸ì¥ì„ ì…ë ¥í•´ë³´ì„¸ìš”.</p>
                <textarea id="korean-input" class="w-full p-2 border border-gray-300 rounded-md h-24" placeholder="ì˜ˆ) ë°¥ ë¨¹ì„ ê¸°ë¶„ì´ ì•„ë‹ˆì•¼"></textarea>
                <button id="translate-btn" class="w-full mt-4 bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg">ì›ì–´ë¯¼ í‘œí˜„ ì°¾ì•„ë³´ê¸°</button>
            </div>
            <div id="translation-result" class="mt-4 p-4 bg-gray-50 rounded-md min-h-[100px] overflow-y-auto">
                 <p class="text-gray-400 text-center">ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</p>
            </div>
        </div>
    </div>

    <!-- Custom Alert Modal -->
    <div id="custom-alert-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-lg shadow-2xl w-full max-w-sm p-6 text-center">
            <p id="custom-alert-message" class="text-gray-700 mb-4"></p>
            <button id="custom-alert-close-btn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-6 rounded-lg">í™•ì¸</button>
        </div>
    </div>

    <!-- ì „ì²´ íŒ¨í„´ ëª©ë¡ íŒì—… (ëª¨ë‹¬) -->
    <div id="all-patterns-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-40">
        <div class="bg-white rounded-lg shadow-2xl w-full max-w-2xl p-6 relative flex flex-col max-h-[90vh]">
            <div class="flex-shrink-0">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-bold text-gray-800">ì „ì²´ íŒ¨í„´ ëª©ë¡</h2>
                    <button id="close-all-patterns-btn" class="p-1 rounded-full hover:bg-gray-200">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6 text-gray-600">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>
                <p class="text-gray-600 mb-4">í•™ìŠµí•˜ê³  ì‹¶ì€ íŒ¨í„´ì„ ì„ íƒí•˜ì„¸ìš”.</p>
            </div>
            <div id="all-patterns-list" class="mt-2 overflow-y-auto divide-y">
                <!-- ì „ì²´ íŒ¨í„´ ëª©ë¡ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤. -->
            </div>
        </div>
    </div>

    <script>
        const patternContainer = document.getElementById('pattern-container');
        const currentDateEl = document.getElementById('current-date');
        const newPatternBtn = document.getElementById('new-pattern-btn');

        // --- ë²ˆì—­ê¸° ëª¨ë‹¬ ê´€ë ¨ ìš”ì†Œ ---
        const openTranslatorBtn = document.getElementById('open-translator-btn');
        const translatorModal = document.getElementById('translator-modal');
        const closeTranslatorBtn = document.getElementById('close-translator-btn');
        const translateBtn = document.getElementById('translate-btn');
        const koreanInput = document.getElementById('korean-input');
        const translationResult = document.getElementById('translation-result');
        const customAlertModal = document.getElementById('custom-alert-modal');
        const customAlertMessage = document.getElementById('custom-alert-message');
        const customAlertCloseBtn = document.getElementById('custom-alert-close-btn');

        // --- ì „ì²´ íŒ¨í„´ ëª¨ë‹¬ ê´€ë ¨ ìš”ì†Œ ---
        const allPatternsBtn = document.getElementById('all-patterns-btn');
        const allPatternsModal = document.getElementById('all-patterns-modal');
        const closeAllPatternsBtn = document.getElementById('close-all-patterns-btn');
        const allPatternsList = document.getElementById('all-patterns-list');

        const allPatterns = [
            {"pattern":"not only A but also B","meaning":"Aë¿ë§Œ ì•„ë‹ˆë¼ Bë„","structure":"not only + ëª…ì‚¬/êµ¬, but also + ëª…ì‚¬/êµ¬","examples":[{"english":"She is not only smart but also kind.","korean":"ê·¸ë…€ëŠ” ë˜‘ë˜‘í•  ë¿ë§Œ ì•„ë‹ˆë¼ ì¹œì ˆí•˜ê¸°ë„ í•´ìš”."},{"english":"He plays not only the guitar but also the piano.","korean":"ê·¸ëŠ” ê¸°íƒ€ë¿ë§Œ ì•„ë‹ˆë¼ í”¼ì•„ë…¸ë„ ì—°ì£¼í•´ìš”."}],"vocab":[{"word":"smart","meaning":"ë˜‘ë˜‘í•œ"},{"word":"kind","meaning":"ì¹œì ˆí•œ"},{"word":"guitar","meaning":"ê¸°íƒ€"},{"word":"piano","meaning":"í”¼ì•„ë…¸"}], "practice": {"korean": "ì´ ë ˆìŠ¤í† ë‘ì€ ìŒì‹ë¿ë§Œ ì•„ë‹ˆë¼ ë¶„ìœ„ê¸°ë„ í›Œë¥­í•´.", "english": "This restaurant has not only great food but also a great atmosphere."}, "practiceVocab": [{"word":"restaurant","meaning":"ë ˆìŠ¤í† ë‘"},{"word":"atmosphere","meaning":"ë¶„ìœ„ê¸°"}]},
            {"pattern":"as soon as","meaning":"~í•˜ìë§ˆì","structure":"as soon as + ì£¼ì–´ + ë™ì‚¬","examples":[{"english":"I'll call you as soon as I get home.","korean":"ì§‘ì— ë„ì°©í•˜ìë§ˆì ì „í™”í• ê²Œ."},{"english":"As soon as she finished her work, she left the office.","korean":"ê·¸ë…€ëŠ” ì¼ì„ ëë‚´ìë§ˆì ì‚¬ë¬´ì‹¤ì„ ë‚˜ê°”ë‹¤."}],"vocab":[{"word":"get home","meaning":"ì§‘ì— ë„ì°©í•˜ë‹¤"},{"word":"finish","meaning":"ëë‚´ë‹¤"},{"word":"leave","meaning":"ë– ë‚˜ë‹¤"}], "practice": {"korean": "ê·¸ ì†Œì‹ì„ ë“£ìë§ˆì, ë‚˜ëŠ” ê·¸ì—ê²Œ ë‹¬ë ¤ê°”ì–´.", "english": "As soon as I heard the news, I ran to him."}, "practiceVocab": [{"word":"hear","meaning":"ë“£ë‹¤"},{"word":"news","meaning":"ì†Œì‹"},{"word":"run","meaning":"ë‹¬ë¦¬ë‹¤"}]},
            {"pattern":"be supposed to","meaning":"~í•˜ê¸°ë¡œ ë˜ì–´ ìˆë‹¤, ~í•´ì•¼ í•œë‹¤","structure":"be supposed to + ë™ì‚¬ì›í˜•","examples":[{"english":"You are supposed to finish this report by Friday.","korean":"ë‹¹ì‹ ì€ ì´ ë³´ê³ ì„œë¥¼ ê¸ˆìš”ì¼ê¹Œì§€ ëë‚´ê¸°ë¡œ ë˜ì–´ ìˆì–´ìš”."},{"english":"What am I supposed to do now?","korean":"ì œê°€ ì´ì œ ë­˜ í•´ì•¼ í•˜ë‚˜ìš”?"}],"vocab":[{"word":"report","meaning":"ë³´ê³ ì„œ"},{"word":"by Friday","meaning":"ê¸ˆìš”ì¼ê¹Œì§€"}], "practice": {"korean": "ìš°ë¦¬ëŠ” 3ì‹œì— íšŒì˜ë¥¼ í•˜ê¸°ë¡œ ë˜ì–´ ìˆì—ˆì–´.", "english": "We were supposed to have a meeting at 3 o'clock."}, "practiceVocab": [{"word":"have a meeting","meaning":"íšŒì˜ë¥¼ í•˜ë‹¤"}]},
            {"pattern":"feel like ~ing","meaning":"~í•˜ê³  ì‹¶ì€ ê¸°ë¶„ì´ë‹¤","structure":"feel like + ë™ëª…ì‚¬","examples":[{"english":"I feel like watching a movie tonight.","korean":"ì˜¤ëŠ˜ ë°¤ ì˜í™” ë³´ê³  ì‹¶ì€ ê¸°ë¶„ì´ì•¼."},{"english":"She didn't feel like going out.","korean":"ê·¸ë…€ëŠ” ì™¸ì¶œí•˜ê³  ì‹¶ì§€ ì•Šì•˜ë‹¤."}],"vocab":[{"word":"watch a movie","meaning":"ì˜í™”ë¥¼ ë³´ë‹¤"},{"word":"go out","meaning":"ì™¸ì¶œí•˜ë‹¤"}], "practice": {"korean": "ë‚˜ëŠ” ì§€ê¸ˆ ì•„ë¬´ê²ƒë„ í•˜ê³  ì‹¶ì§€ ì•Šì•„.", "english": "I don't feel like doing anything right now."}, "practiceVocab": [{"word":"anything","meaning":"ì•„ë¬´ê²ƒë„"},{"word":"right now","meaning":"ì§€ê¸ˆ ë‹¹ì¥"}]},
            {"pattern":"used to","meaning":"~í•˜ê³¤ í–ˆë‹¤ (ê³¼ê±°ì˜ ìŠµê´€)","structure":"used to + ë™ì‚¬ì›í˜•","examples":[{"english":"I used to live in this neighborhood.","korean":"ë‚˜ëŠ” ì´ ë™ë„¤ì— ì‚´ì•˜ì—ˆë‹¤."},{"english":"He used to play basketball a lot when he was young.","korean":"ê·¸ëŠ” ì–´ë ¸ì„ ë•Œ ë†êµ¬ë¥¼ ë§ì´ í•˜ê³¤ í–ˆë‹¤."}],"vocab":[{"word":"live","meaning":"ì‚´ë‹¤"},{"word":"neighborhood","meaning":"ë™ë„¤, ì´ì›ƒ"},{"word":"a lot","meaning":"ë§ì´"}], "practice": {"korean": "ìš°ë¦¬ëŠ” ì£¼ë§ë§ˆë‹¤ í•¨ê»˜ í•˜ì´í‚¹ì„ ê°€ê³¤ í–ˆì–´.", "english": "We used to go hiking together every weekend."}, "practiceVocab": [{"word":"go hiking","meaning":"í•˜ì´í‚¹ ê°€ë‹¤"},{"word":"together","meaning":"í•¨ê»˜"},{"word":"every weekend","meaning":"ì£¼ë§ë§ˆë‹¤"}]},
            {"pattern":"It's no use ~ing","meaning":"~í•´ë´ì•¼ ì†Œìš©ì—†ë‹¤","structure":"It's no use + ë™ëª…ì‚¬","examples":[{"english":"It's no use crying over spilt milk.","korean":"ì—ì§ˆëŸ¬ì§„ ìš°ìœ  ì•ì—ì„œ ìš¸ì–´ë´ì•¼ ì†Œìš©ì—†ë‹¤ (ì†ë‹´)."},{"english":"It's no use trying to convince him. He won't change his mind.","korean":"ê·¸ë¥¼ ì„¤ë“í•˜ë ¤ê³  í•´ë´ì•¼ ì†Œìš©ì—†ì–´. ê·¸ëŠ” ë§ˆìŒì„ ë°”ê¾¸ì§€ ì•Šì„ ê±°ì•¼."}],"vocab":[{"word":"cry over","meaning":"~ì— ëŒ€í•´ ìš¸ë‹¤"},{"word":"convince","meaning":"ì„¤ë“í•˜ë‹¤"},{"word":"change one's mind","meaning":"ë§ˆìŒì„ ë°”ê¾¸ë‹¤"}], "practice": {"korean": "ì§€ê¸ˆ ì™€ì„œ í›„íšŒí•´ë´ì•¼ ì†Œìš©ì—†ì–´.", "english": "It's no use regretting it now."}, "practiceVocab": [{"word":"regret","meaning":"í›„íšŒí•˜ë‹¤"}]},
            {"pattern":"can't help ~ing","meaning":"~í•˜ì§€ ì•Šì„ ìˆ˜ ì—†ë‹¤","structure":"can't help + ë™ëª…ì‚¬","examples":[{"english":"I couldn't help laughing when I saw his face.","korean":"ê·¸ì˜ ì–¼êµ´ì„ ë´¤ì„ ë•Œ ì›ƒì§€ ì•Šì„ ìˆ˜ ì—†ì—ˆë‹¤."},{"english":"She can't help worrying about her son.","korean":"ê·¸ë…€ëŠ” ì•„ë“¤ ê±±ì •ì„ í•˜ì§€ ì•Šì„ ìˆ˜ ì—†ë‹¤."}],"vocab":[{"word":"laugh","meaning":"ì›ƒë‹¤"},{"word":"worry about","meaning":"~ì— ëŒ€í•´ ê±±ì •í•˜ë‹¤"}], "practice": {"korean": "ë‚˜ëŠ” ê·¸ ì˜í™”ë¥¼ ë³´ê³  ê°ë™ë°›ì§€ ì•Šì„ ìˆ˜ ì—†ì—ˆì–´.", "english": "I couldn't help being moved by the movie."}, "practiceVocab": [{"word":"be moved","meaning":"ê°ë™ë°›ë‹¤"}]},
            {"pattern":"look forward to ~ing","meaning":"~í•˜ê¸°ë¥¼ ê³ ëŒ€í•˜ë‹¤","structure":"look forward to + (ë™)ëª…ì‚¬","examples":[{"english":"I'm looking forward to seeing you again.","korean":"ë‹¤ì‹œ ëµ™ê¸°ë¥¼ ê³ ëŒ€í•˜ê³  ìˆìŠµë‹ˆë‹¤."},{"english":"We are looking forward to our vacation.","korean":"ìš°ë¦¬ëŠ” íœ´ê°€ë¥¼ ê³ ëŒ€í•˜ê³  ìˆì–´ìš”."}],"vocab":[{"word":"see you again","meaning":"ë‹¤ì‹œ ë§Œë‚˜ë‹¤"},{"word":"vacation","meaning":"íœ´ê°€"}], "practice": {"korean": "ì €ëŠ” ë‹¹ì‹ ì˜ ë‹µë³€ì„ ë°›ê¸°ë¥¼ ê³ ëŒ€í•˜ê² ìŠµë‹ˆë‹¤.", "english": "I look forward to hearing from you."}, "practiceVocab": [{"word":"hear from","meaning":"~ë¡œë¶€í„° ì†Œì‹ì„ ë“£ë‹¤"}]},
            {"pattern":"It takes (time) to","meaning":"~í•˜ëŠ” ë° (ì‹œê°„)ì´ ê±¸ë¦¬ë‹¤","structure":"It takes + ì‹œê°„ + to + ë™ì‚¬ì›í˜•","examples":[{"english":"It takes about an hour to get there.","korean":"ê±°ê¸°ê¹Œì§€ ê°€ëŠ” ë° ì•½ í•œ ì‹œê°„ì´ ê±¸ë ¤ìš”."},{"english":"How long does it take to learn a new language?","korean":"ìƒˆë¡œìš´ ì–¸ì–´ë¥¼ ë°°ìš°ëŠ” ë° ì–¼ë§ˆë‚˜ ê±¸ë¦¬ë‚˜ìš”?"}],"vocab":[{"word":"about an hour","meaning":"ì•½ í•œ ì‹œê°„"},{"word":"get there","meaning":"ê±°ê¸°ì— ë„ì°©í•˜ë‹¤"},{"word":"learn","meaning":"ë°°ìš°ë‹¤"}], "practice": {"korean": "ì´ ë¬¸ì œë¥¼ í•´ê²°í•˜ëŠ” ë° ì‹œê°„ì´ ì¢€ ê±¸ë¦´ ê±°ì•¼.", "english": "It will take some time to solve this problem."}, "practiceVocab": [{"word":"some time","meaning":"ì‹œê°„ì´ ì¢€"},{"word":"solve","meaning":"í•´ê²°í•˜ë‹¤"},{"word":"problem","meaning":"ë¬¸ì œ"}]},
            {"pattern":"be likely to","meaning":"~í•  ê²ƒ ê°™ë‹¤, ~í•  ê°€ëŠ¥ì„±ì´ ë†’ë‹¤","structure":"be likely to + ë™ì‚¬ì›í˜•","examples":[{"english":"It's likely to rain this afternoon.","korean":"ì˜¤ëŠ˜ ì˜¤í›„ì— ë¹„ê°€ ì˜¬ ê²ƒ ê°™ì•„ìš”."},{"english":"He is likely to win the election.","korean":"ê·¸ëŠ” ì„ ê±°ì—ì„œ ì´ê¸¸ ê°€ëŠ¥ì„±ì´ ë†’ë‹¤."}],"vocab":[{"word":"rain","meaning":"ë¹„ê°€ ì˜¤ë‹¤"},{"word":"win","meaning":"ì´ê¸°ë‹¤"},{"word":"election","meaning":"ì„ ê±°"}], "practice": {"korean": "ê·¸ë“¤ì€ ì œ ì‹œê°„ì— ë„ì°©í•  ê²ƒ ê°™ì§€ ì•Šì•„.", "english": "They are not likely to arrive on time."}, "practiceVocab": [{"word":"arrive","meaning":"ë„ì°©í•˜ë‹¤"},{"word":"on time","meaning":"ì œ ì‹œê°„ì—"}]},
            {"pattern":"had better","meaning":"~í•˜ëŠ” í¸ì´ ë‚«ë‹¤ (ì¶©ê³ )","structure":"had better + ë™ì‚¬ì›í˜•","examples":[{"english":"You had better see a doctor.","korean":"ë„ˆëŠ” ì˜ì‚¬ì—ê²Œ ì§„ì°°ì„ ë°›ëŠ” í¸ì´ ë‚«ê² ë‹¤."},{"english":"We'd better hurry, or we'll miss the train.","korean":"ì„œë‘ë¥´ëŠ” ê²Œ ì¢‹ê² ì–´, ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ ê¸°ì°¨ë¥¼ ë†“ì¹  ê±°ì•¼."}],"vocab":[{"word":"see a doctor","meaning":"ì§„ì°°ë°›ë‹¤"},{"word":"hurry","meaning":"ì„œë‘ë¥´ë‹¤"},{"word":"miss the train","meaning":"ê¸°ì°¨ë¥¼ ë†“ì¹˜ë‹¤"}], "practice": {"korean": "ë„ˆëŠ” ê·¸ì—ê²Œ ì‚¬ì‹¤ì„ ë§í•˜ëŠ” í¸ì´ ë‚«ê² ì–´.", "english": "You had better tell him the truth."}, "practiceVocab": [{"word":"tell","meaning":"ë§í•˜ë‹¤"},{"word":"truth","meaning":"ì‚¬ì‹¤, ì§„ì‹¤"}]},
            {"pattern":"prefer A to B","meaning":"Bë³´ë‹¤ Aë¥¼ ë” ì„ í˜¸í•˜ë‹¤","structure":"prefer + ëª…ì‚¬ A + to + ëª…ì‚¬ B","examples":[{"english":"I prefer coffee to tea.","korean":"ì €ëŠ” ì°¨ë³´ë‹¤ ì»¤í”¼ë¥¼ ë” ì„ í˜¸í•´ìš”."},{"english":"She prefers reading books to watching TV.","korean":"ê·¸ë…€ëŠ” TV ë³´ëŠ” ê²ƒë³´ë‹¤ ì±… ì½ëŠ” ê²ƒì„ ë” ì„ í˜¸í•œë‹¤."}],"vocab":[{"word":"prefer","meaning":"ì„ í˜¸í•˜ë‹¤"},{"word":"coffee","meaning":"ì»¤í”¼"},{"word":"tea","meaning":"ì°¨"}], "practice": {"korean": "ë‚˜ëŠ” ì—¬ë¦„ë³´ë‹¤ ê²¨ìš¸ì„ ë” ì¢‹ì•„í•´.", "english": "I prefer winter to summer."}, "practiceVocab": [{"word":"winter","meaning":"ê²¨ìš¸"},{"word":"summer","meaning":"ì—¬ë¦„"}]},
            {"pattern":"be about to","meaning":"ë§‰ ~í•˜ë ¤ë˜ ì°¸ì´ë‹¤","structure":"be about to + ë™ì‚¬ì›í˜•","examples":[{"english":"I was about to call you.","korean":"ë§‰ ë„ˆì—ê²Œ ì „í™”í•˜ë ¤ë˜ ì°¸ì´ì—ˆì–´."},{"english":"The show is about to start.","korean":"ì‡¼ê°€ ê³§ ì‹œì‘ë  ê²ë‹ˆë‹¤."}],"vocab":[{"word":"call","meaning":"ì „í™”í•˜ë‹¤"},{"word":"show","meaning":"ì‡¼"},{"word":"start","meaning":"ì‹œì‘í•˜ë‹¤"}], "practice": {"korean": "ìš°ë¦¬ê°€ ë§‰ ì§‘ì„ ë– ë‚˜ë ¤ë˜ ì°¸ì— ë¹„ê°€ ì˜¤ê¸° ì‹œì‘í–ˆì–´.", "english": "We were about to leave the house when it started to rain."}, "practiceVocab": [{"word":"leave the house","meaning":"ì§‘ì„ ë– ë‚˜ë‹¤"},{"word":"when","meaning":"~í•  ë•Œ"}]},
            {"pattern":"end up ~ing","meaning":"ê²°êµ­ ~í•˜ê²Œ ë˜ë‹¤","structure":"end up + ë™ëª…ì‚¬ / ì „ì¹˜ì‚¬êµ¬","examples":[{"english":"We ended up watching a movie at home instead of going out.","korean":"ìš°ë¦¬ëŠ” ì™¸ì¶œí•˜ëŠ” ëŒ€ì‹  ê²°êµ­ ì§‘ì—ì„œ ì˜í™”ë¥¼ ë³´ê²Œ ë˜ì—ˆë‹¤."},{"english":"If you keep spending money like that, you'll end up broke.","korean":"ê³„ì† ê·¸ëŸ° ì‹ìœ¼ë¡œ ëˆì„ ì“°ë©´, ë„ˆëŠ” ê²°êµ­ íŒŒì‚°í•˜ê²Œ ë  ê±°ì•¼."}],"vocab":[{"word":"instead of","meaning":"~ëŒ€ì‹ ì—"},{"word":"spend money","meaning":"ëˆì„ ì“°ë‹¤"},{"word":"broke","meaning":"íŒŒì‚°í•œ"}], "practice": {"korean": "ë‚˜ëŠ” ê¸¸ì„ ìƒì—ˆê³  ê²°êµ­ ì´ìƒí•œ ê³³ì— ê°€ê²Œ ë˜ì—ˆì–´.", "english": "I got lost and ended up in a strange place."}, "practiceVocab": [{"word":"get lost","meaning":"ê¸¸ì„ ìƒë‹¤"},{"word":"strange place","meaning":"ì´ìƒí•œ ê³³"}]},
            {"pattern":"make sense","meaning":"ë§ì´ ë˜ë‹¤, ì´ì¹˜ì— ë§ë‹¤","structure":"make sense","examples":[{"english":"What you're saying doesn't make any sense.","korean":"ë„¤ê°€ í•˜ëŠ” ë§ì€ ì „í˜€ ì´ì¹˜ì— ë§ì§€ ì•Šì•„."},{"english":"It makes sense to save money for the future.","korean":"ë¯¸ë˜ë¥¼ ìœ„í•´ ëˆì„ ì €ì¶•í•˜ëŠ” ê²ƒì€ ì´ì¹˜ì— ë§ë‹¤."}],"vocab":[{"word":"make sense","meaning":"ì´ì¹˜ì— ë§ë‹¤"},{"word":"save money","meaning":"ëˆì„ ì €ì¶•í•˜ë‹¤"},{"word":"future","meaning":"ë¯¸ë˜"}], "practice": {"korean": "ì•„, ì´ì œì•¼ ì´í•´ê°€ ë˜ë„¤.", "english": "Oh, now it makes sense."}, "practiceVocab": [{"word":"now","meaning":"ì´ì œ"}]},
            {"pattern":"be worth ~ing","meaning":"~í•  ê°€ì¹˜ê°€ ìˆë‹¤","structure":"be worth + (ë™)ëª…ì‚¬","examples":[{"english":"This book is worth reading.","korean":"ì´ ì±…ì€ ì½ì„ ê°€ì¹˜ê°€ ìˆë‹¤."},{"english":"The view from the top is worth the climb.","korean":"ì •ìƒì—ì„œ ë³´ëŠ” ê²½ì¹˜ëŠ” ì˜¬ë¼ê°ˆ ë§Œí•œ ê°€ì¹˜ê°€ ìˆë‹¤."}],"vocab":[{"word":"worth","meaning":"~ì˜ ê°€ì¹˜ê°€ ìˆëŠ”"},{"word":"reading","meaning":"ì½ê¸°"},{"word":"view","meaning":"ê²½ì¹˜"},{"word":"climb","meaning":"ë“±ë°˜"}], "practice": {"korean": "ê·¸ ë°•ë¬¼ê´€ì€ ë°©ë¬¸í•  ê°€ì¹˜ê°€ ìˆì–´.", "english": "That museum is worth visiting."}, "practiceVocab": [{"word":"museum","meaning":"ë°•ë¬¼ê´€"},{"word":"visit","meaning":"ë°©ë¬¸í•˜ë‹¤"}]},
            {"pattern":"no matter what","meaning":"ë¬´ì—‡ì´ë“  ê°„ì—, ë¬´ìŠ¨ ì¼ì´ ìˆì–´ë„","structure":"no matter what, ì£¼ì–´ + ë™ì‚¬","examples":[{"english":"No matter what happens, I'll always be on your side.","korean":"ë¬´ìŠ¨ ì¼ì´ ì¼ì–´ë‚˜ë“ , ë‚˜ëŠ” í•­ìƒ ë„¤ í¸ì¼ ê±°ì•¼."},{"english":"She is determined to succeed, no matter what.","korean":"ê·¸ë…€ëŠ” ë¬´ì—‡ì´ë“  ê°„ì— ì„±ê³µí•˜ê¸°ë¡œ ê²°ì‹¬í–ˆë‹¤."}],"vocab":[{"word":"no matter","meaning":"~ì— ìƒê´€ì—†ì´"},{"word":"happen","meaning":"ì¼ì–´ë‚˜ë‹¤"},{"word":"be on one's side","meaning":"~ì˜ í¸ì´ë‹¤"},{"word":"determined","meaning":"ê²°ì‹¬ì´ êµ³ì€"}], "practice": {"korean": "ë¬´ìŠ¨ ì¼ì´ ìˆì–´ë„ ë„ˆëŠ” ë„ˆì˜ ê¿ˆì„ í¬ê¸°í•´ì„œëŠ” ì•ˆ ë¼.", "english": "You should not give up on your dreams, no matter what."}, "practiceVocab": [{"word":"give up on","meaning":"~ì„ í¬ê¸°í•˜ë‹¤"},{"word":"dream","meaning":"ê¿ˆ"}]}
        ];

        let learningCounts = {};
        // --- TTS (Text-to-Speech) ê´€ë ¨ ë³€ìˆ˜ ---
        const audioCache = {};
        let currentAudio = null;
        let currentPlayingButton = null;

        function initializeCounts() {
            const storedCounts = localStorage.getItem('englishLearningCounts');
            if (storedCounts) {
                learningCounts = JSON.parse(storedCounts);
            } else {
                learningCounts = {};
            }
        }

        function saveCounts() {
            localStorage.setItem('englishLearningCounts', JSON.stringify(learningCounts));
        }

        function getTodayString() {
            const today = new Date();
            return today.toISOString().split('T')[0];
        }

        function displayDate() {
            const today = new Date();
            const year = today.getFullYear();
            const month = today.getMonth() + 1;
            const date = today.getDate();
            currentDateEl.textContent = `${year}ë…„ ${month}ì›” ${date}ì¼`;
        }

        function getRandomPatterns() {
            const shuffled = [...allPatterns].sort(() => 0.5 - Math.random());
            return shuffled.slice(0, 2);
        }

       function renderPatterns(patterns, showIndex = false) {
            patternContainer.innerHTML = '';
            patterns.forEach((p, index) => {
                const count = learningCounts[p.pattern] || 0;
                const card = document.createElement('div');
                card.className = 'bg-white p-6 rounded-lg shadow-md hover:shadow-lg transition-shadow duration-300';
                
                let examplesHtml = p.examples.map(ex => `
                    <div class="mt-3">
                        <div class="flex items-center">
                            <p class="text-lg english-text text-gray-800">${ex.english}</p>
                            <button class="tts-btn ml-2 p-1 rounded-full hover:bg-gray-200 transition-colors">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 text-gray-500 pointer-events-none">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M19.114 5.636a9 9 0 010 12.728M16.463 8.288a5.25 5.25 0 010 7.424M6.75 8.25l4.72-4.72a.75.75 0 011.28.53v15.88a.75.75 0 01-1.28.53l-4.72-4.72H4.51c-.88 0-1.704-.507-1.938-1.354A9.01 9.01 0 012.25 12c0-.83.112-1.633.322-2.396C2.806 8.756 3.63 8.25 4.51 8.25H6.75z" />
                                </svg>
                            </button>
                        </div>
                        <p class="text-md text-gray-600">${ex.korean}</p>
                    </div>
                `).join('');

                let vocabHtml = p.vocab.map(v => `
                    <div class="flex items-baseline">
                        <p class="w-1/2 text-md english-text text-gray-700 font-medium">${v.word}</p>
                        <p class="w-1/2 text-sm text-gray-600">${v.meaning}</p>
                    </div>
                `).join('');

                const indexHtml = showIndex ? `<span class="bg-blue-100 text-blue-800 text-sm font-semibold mr-3 px-3 py-1 rounded-full">${index + 1}</span>` : '';
                
                let practiceHtml = '';
                if (p.practice) {
                    practiceHtml = `
                        <div class="mt-6">
                            <h3 class="text-lg font-bold text-gray-700 border-b pb-1">âœï¸ ì§ì ‘ ë§í•´ë³´ê¸°</h3>
                            <div class="mt-3 bg-sky-50 p-4 rounded-lg relative">
                                <button id="show-hint-btn-${index}" data-pattern-string="${p.pattern}" data-hint-target="practice-hint-${index}" class="show-hint-btn absolute top-4 right-4 bg-gray-300 hover:bg-gray-400 text-gray-700 font-bold py-1 px-2 rounded-lg text-xs whitespace-nowrap">íŒíŠ¸ ë³´ê¸°</button>
                                <p class="text-md text-gray-700 mb-2">ë‹¤ìŒ ë¬¸ì¥ì„ ì˜ì–´ë¡œ ì…ë ¥í•´ë³´ì„¸ìš”:</p>
                                <p class="text-md font-semibold text-sky-800 mb-3">"${p.practice.korean}"</p>
                                <div class="flex items-center space-x-2">
                                    <input type="text" id="practice-input-${index}" class="w-full p-2 border border-gray-300 rounded-md english-text" placeholder="ì˜ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”...">
                                    <button id="check-practice-btn-${index}" data-answer="${p.practice.english}" data-input-id="practice-input-${index}" class="check-practice-btn bg-sky-500 hover:bg-sky-600 text-white font-bold py-2 px-4 rounded-lg whitespace-nowrap">ì •ë‹µ í™•ì¸</button>
                                </div>
                                <div id="practice-hint-${index}" class="mt-3"></div>
                                <div id="practice-result-${index}" class="mt-3 text-center"></div>
                            </div>
                        </div>
                    `;
                }

                card.innerHTML = `
                    <div class="flex items-center justify-between mb-3">
                        <div class="flex items-center">
                             ${indexHtml}
                            <div>
                               <h2 class="text-2xl font-bold text-gray-800 english-text">${p.pattern}</h2>
                            </div>
                        </div>
                        <div class="text-right">
                               <button data-pattern="${p.pattern}" class="learn-btn bg-yellow-400 hover:bg-yellow-500 text-white text-sm font-bold py-1 px-3 rounded-full transition-colors">í•™ìŠµ ì™„ë£Œ!</button>
                               <p class="text-xs text-gray-500 mt-1">í•™ìŠµ <span class="font-bold text-red-500 count-display">${count}</span>íšŒ</p>
                        </div>
                    </div>
                    <div class="mt-4">
                        <p class="text-lg text-blue-700 font-semibold mb-2">${p.meaning}</p>
                        <p class="text-sm text-gray-500 bg-gray-100 p-2 rounded-md"><b>ğŸ¤” ì–´ë–»ê²Œ ì‚¬ìš©í• ê¹Œìš”?</b> ${p.structure || 'êµ¬ì¡° ì •ë³´ ì—†ìŒ'}</p>
                    </div>
                    
                    <div class="mt-4">
                        <h3 class="text-lg font-bold text-gray-700 border-b pb-1">ğŸ’¡ ì˜ˆë¬¸ ì‚´í´ë³´ê¸°</h3>
                        ${examplesHtml}
                    </div>

                    <div class="mt-6">
                        <h3 class="text-lg font-bold text-gray-700 border-b pb-1">ğŸ“Œ ì£¼ìš” ë‹¨ì–´</h3>
                        <div class="mt-3 space-y-2">
                           ${vocabHtml}
                        </div>
                    </div>
                    ${practiceHtml}
                `;
                patternContainer.appendChild(card);
            });
        }
        
        function loadDailyPatterns() {
            const todayStr = getTodayString();
            const storedData = JSON.parse(localStorage.getItem('dailyEnglishPatterns'));

            if (storedData && storedData.date === todayStr) {
                renderPatterns(storedData.patterns);
            } else {
                const newPatterns = getRandomPatterns();
                localStorage.setItem('dailyEnglishPatterns', JSON.stringify({ date: todayStr, patterns: newPatterns }));
                renderPatterns(newPatterns);
            }
        }
        
        // --- ì „ì²´ íŒ¨í„´ ëª©ë¡ ë Œë”ë§ í•¨ìˆ˜ ---
        function renderAllPatternsList() {
            allPatternsList.innerHTML = '';
            allPatterns.forEach((p, index) => {
                const patternItem = document.createElement('div');
                patternItem.className = 'p-4 hover:bg-gray-100 cursor-pointer';
                patternItem.dataset.patternIndex = index;
                patternItem.innerHTML = `
                    <div class="flex items-start pointer-events-none">
                        <span class="mr-3 text-gray-500 font-medium w-8 text-right">${index + 1}.</span>
                        <div>
                            <p class="text-lg font-semibold english-text text-gray-800">${p.pattern}</p>
                            <p class="text-sm text-gray-600">${p.meaning}</p>
                        </div>
                    </div>
                `;
                allPatternsList.appendChild(patternItem);
            });
        }

        
        // --- ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ---

        newPatternBtn.addEventListener('click', () => {
             const newPatterns = getRandomPatterns();
             localStorage.setItem('dailyEnglishPatterns', JSON.stringify({ date: getTodayString(), patterns: newPatterns }));
             renderPatterns(newPatterns);
             window.scrollTo(0, 0);
        });

        patternContainer.addEventListener('click', (e) => {
            if (e.target.classList.contains('learn-btn')) {
                const pattern = e.target.dataset.pattern;
                learningCounts[pattern] = (learningCounts[pattern] || 0) + 1;
                saveCounts();
                e.target.nextElementSibling.querySelector('.count-display').textContent = learningCounts[pattern];
            } else if (e.target.classList.contains('check-practice-btn')) {
                const button = e.target;
                const inputId = button.dataset.inputId;
                const index = inputId.split('-').pop();
                
                const correctAnswer = button.dataset.answer;
                const userInput = document.getElementById(inputId).value.trim();
                const resultDiv = document.getElementById(`practice-result-${index}`);
                
                const normalize = (str) => str.replace(/[.,'â€™"?!]/g, '').replace(/\s+/g, ' ').toLowerCase();

                let resultMessageHtml = '';
                
                const answerHtml = `
                    <div class="mt-2 p-2 bg-gray-100 rounded text-left">
                        <p class="text-sm">ì •ë‹µ:</p>
                        <div class="flex items-center">
                            <p class="text-md english-text font-semibold text-gray-800">${correctAnswer}</p>
                            <button class="tts-btn ml-2 p-1 rounded-full hover:bg-gray-200 transition-colors">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 text-gray-500 pointer-events-none">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M19.114 5.636a9 9 0 010 12.728M16.463 8.288a5.25 5.25 0 010 7.424M6.75 8.25l4.72-4.72a.75.75 0 011.28.53v15.88a.75.75 0 01-1.28.53l-4.72-4.72H4.51c-.88 0-1.704-.507-1.938-1.354A9.01 9.01 0 012.25 12c0-.83.112-1.633.322-2.396C2.806 8.756 3.63 8.25 4.51 8.25H6.75z" />
                                </svg>
                            </button>
                        </div>
                    </div>
                `;

                if (normalize(userInput) === normalize(correctAnswer)) {
                    resultMessageHtml = `<p class="text-green-600 font-bold text-lg">ğŸ‰ ì •ë‹µì…ë‹ˆë‹¤!</p>` + answerHtml;
                } else {
                    resultMessageHtml = `
                        <p class="text-red-500 font-bold text-lg">ğŸ¤” ì•„ì‰½ë„¤ìš”, ë‹¤ì‹œ ì‹œë„í•´ë³´ì„¸ìš”.</p>
                        ${answerHtml}
                    `;
                }

                resultDiv.innerHTML = `
                    ${resultMessageHtml}
                    <button class="retry-practice-btn mt-3 bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg" data-practice-index="${index}">
                        ë‹¤ì‹œí•˜ê¸°
                    </button>
                `;
                
                button.style.display = 'none';
                document.getElementById(`show-hint-btn-${index}`).style.display = 'none';

            } else if (e.target.classList.contains('show-hint-btn')) {
                const button = e.target;
                const patternString = button.dataset.patternString;
                const hintTargetId = button.dataset.hintTarget;
                const hintDiv = document.getElementById(hintTargetId);

                const patternData = allPatterns.find(p => p.pattern === patternString);

                if (patternData && patternData.practiceVocab && patternData.practiceVocab.length > 0) {
                    const shuffledVocab = [...patternData.practiceVocab].sort(() => 0.5 - Math.random());
                    
                    const hintsHtml = shuffledVocab.map(hint => `
                        <div class="flex items-baseline" style="line-height: 1.3;">
                            <span class="inline-block w-[50%] font-medium english-text pr-2">${hint.word}</span>
                            <span class="inline-block w-[50%] text-sm text-gray-600">${hint.meaning}</span>
                        </div>
                    `).join('');

                    hintDiv.innerHTML = `
                    <div class="bg-white/50 rounded-md p-2 text-left">
                        <div class="flex items-center mb-1">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 mr-0.5 text-yellow-500">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.898 20.572L16.25 21.75l-.648-1.178a2.625 2.625 0 00-1.933-1.933L12.5 18l1.178-.648a2.625 2.625 0 001.933-1.933L16.25 14.25l.648 1.178a2.625 2.625 0 001.933 1.933L20 18l-1.178.648a2.625 2.625 0 00-1.933 1.933z" />
                            </svg>
                            <span class="font-semibold text-sm text-gray-700">íŒíŠ¸</span>
                        </div>
                        <div class="border-t border-gray-300/50 pt-1">${hintsHtml}</div>
                    </div>`;
                    
                } else {
                    hintDiv.innerHTML = `<p class="text-sm text-gray-500">ì´ ë¬¸ì¥ì— ëŒ€í•œ í•µì‹¬ ë‹¨ì–´ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</p>`;
                }
                
                button.disabled = true;
                button.classList.add('opacity-50', 'cursor-not-allowed');
            } else if (e.target.classList.contains('retry-practice-btn')) {
                const index = e.target.dataset.practiceIndex;

                document.getElementById(`practice-input-${index}`).value = '';
                document.getElementById(`practice-result-${index}`).innerHTML = '';
                document.getElementById(`practice-hint-${index}`).innerHTML = '';

                document.getElementById(`check-practice-btn-${index}`).style.display = '';
                const hintBtn = document.getElementById(`show-hint-btn-${index}`);
                hintBtn.style.display = '';
                hintBtn.disabled = false;
                hintBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            }
        });
        
        // 'ì§ì ‘ ë§í•´ë³´ê¸°' ì…ë ¥ì°½ì—ì„œ Enter í‚¤ë¡œ ì •ë‹µ í™•ì¸ ê¸°ëŠ¥ ì¶”ê°€
        patternContainer.addEventListener('keydown', (e) => {
            if (e.target.id.startsWith('practice-input-') && e.key === 'Enter') {
                e.preventDefault(); 
                const checkButton = e.target.nextElementSibling;
                if (checkButton && checkButton.classList.contains('check-practice-btn')) {
                    checkButton.click();
                }
            }
        });
        
        openTranslatorBtn.addEventListener('click', () => translatorModal.classList.remove('hidden'));
        closeTranslatorBtn.addEventListener('click', () => {
            translatorModal.classList.add('hidden');
            if (currentAudio) {
                currentAudio.pause();
                currentAudio = null;
            }
        });

        // 'ì „ì²´ íŒ¨í„´ ë³´ê¸°' ëª¨ë‹¬ ì´ë²¤íŠ¸
        allPatternsBtn.addEventListener('click', () => {
            allPatternsModal.classList.remove('hidden');
        });

        closeAllPatternsBtn.addEventListener('click', () => {
            allPatternsModal.classList.add('hidden');
        });

        allPatternsList.addEventListener('click', (e) => {
            const selectedPatternDiv = e.target.closest('[data-pattern-index]');
            if (selectedPatternDiv) {
                const patternIndex = parseInt(selectedPatternDiv.dataset.patternIndex, 10);
                const selectedPattern = allPatterns[patternIndex];
                if (selectedPattern) {
                    renderPatterns([selectedPattern]);
                    allPatternsModal.classList.add('hidden');
                    window.scrollTo(0, 0);
                }
            }
        });

        translateBtn.addEventListener('click', async () => {
            const koreanText = koreanInput.value.trim();
            if (!koreanText) {
                showAlert('ë²ˆì—­í•  í•œêµ­ì–´ ë¬¸ì¥ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            translationResult.innerHTML = '<div class="loader mx-auto"></div>';

            try {
                const resultText = await getNativeTranslation(koreanText);
                const lines = resultText.split('\n').filter(line => line.trim() !== '');

                const englishText = lines.find(line => !line.startsWith('#')) || 'ë²ˆì—­ ê²°ê³¼ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
                const explanationText = lines.slice(lines.findIndex(line => line.startsWith('####'))).join('<br>') || 'ì„¤ëª…ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';

                translationResult.innerHTML = `
                    <h3 class="text-xl font-bold text-gray-800 mt-2">ìì—°ìŠ¤ëŸ¬ìš´ í‘œí˜„</h3>
                    <div class="flex items-center">
                        <p class="text-lg english-text text-gray-800">${englishText.replace('### ìì—°ìŠ¤ëŸ¬ìš´ í‘œí˜„', '').trim()}</p>
                        <button class="tts-btn ml-2 p-1 rounded-full hover:bg-gray-200 transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 text-gray-500 pointer-events-none">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M19.114 5.636a9 9 0 010 12.728M16.463 8.288a5.25 5.25 0 010 7.424M6.75 8.25l4.72-4.72a.75.75 0 011.28.53v15.88a.75.75 0 01-1.28.53l-4.72-4.72H4.51c-.88 0-1.704-.507-1.938-1.354A9.01 9.01 0 012.25 12c0-.83.112-1.633.322-2.396C2.806 8.756 3.63 8.25 4.51 8.25H6.75z" />
                            </svg>
                        </button>
                    </div>
                    <h4 class="text-lg font-semibold text-gray-700 mt-2">ğŸ’¡ ì´ë ‡ê²Œ í‘œí˜„í•˜ëŠ” ì´ìœ </h4>
                    <p>${explanationText.replace('#### ğŸ’¡ ì´ë ‡ê²Œ í‘œí˜„í•˜ëŠ” ì´ìœ ', '').trim()}</p>
                `;

            } catch (error) {
                console.error('Translation error:', error);
                showAlert(`ë²ˆì—­ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì„œë²„ ì‘ë‹µ: ${error.message}`);
            }
        });

        function showAlert(message) {
            customAlertMessage.textContent = message;
            customAlertModal.classList.remove('hidden');
        }
        
        customAlertCloseBtn.addEventListener('click', () => {
            customAlertModal.classList.add('hidden');
        });

        // --- TTS (Text-to-Speech) ê´€ë ¨ í•¨ìˆ˜ ---

        function base64ToArrayBuffer(base64) {
            const binaryString = window.atob(base64);
            const len = binaryString.length;
            const bytes = new Uint8Array(len);
            for (let i = 0; i < len; i++) {
                bytes[i] = binaryString.charCodeAt(i);
            }
            return bytes.buffer;
        }

        function pcmToWav(pcmDataView, sampleRate) {
            const header = new ArrayBuffer(44);
            const view = new DataView(header);
            const numChannels = 1;
            const bytesPerSample = 2; // 16-bit
            const blockAlign = numChannels * bytesPerSample;
            const byteRate = sampleRate * blockAlign;
            const dataSize = pcmDataView.byteLength;

            // RIFF chunk descriptor
            writeString(view, 0, 'RIFF');
            view.setUint32(4, 36 + dataSize, true);
            writeString(view, 8, 'WAVE');
            // "fmt " sub-chunk
            writeString(view, 12, 'fmt ');
            view.setUint32(16, 16, true); // Subchunk1Size for PCM
            view.setUint16(20, 1, true); // AudioFormat for PCM
            view.setUint16(22, numChannels, true);
            view.setUint32(24, sampleRate, true);
            view.setUint32(28, byteRate, true);
            view.setUint16(32, blockAlign, true);
            view.setUint16(34, 16, true); // BitsPerSample
            // "data" sub-chunk
            writeString(view, 36, 'data');
            view.setUint32(40, dataSize, true);

            function writeString(view, offset, string) {
                for (let i = 0; i < string.length; i++) {
                    view.setUint8(offset + i, string.charCodeAt(i));
                }
            }
            
            return new Blob([view.buffer, pcmDataView.buffer], { type: 'audio/wav' });
        }
        
        async function playAudio(text, buttonEl) {
            if (currentAudio) {
                currentAudio.pause();
                currentAudio.currentTime = 0;
            }
            document.querySelectorAll('.tts-btn.is-playing').forEach(btn => btn.classList.remove('is-playing'));

            if (currentPlayingButton === buttonEl) {
                currentPlayingButton = null;
                currentAudio = null;
                return;
            }

            buttonEl.classList.add('is-playing');
            currentPlayingButton = buttonEl;

            const playFromAudioObject = (audioObj) => {
                currentAudio = audioObj;
                currentAudio.currentTime = 0;

                const onEnd = () => {
                    buttonEl.classList.remove('is-playing');
                    currentAudio.removeEventListener('ended', onEnd);
                    if (currentPlayingButton === buttonEl) {
                        currentPlayingButton = null;
                        currentAudio = null;
                    }
                };
                currentAudio.addEventListener('ended', onEnd);
                
                const playPromise = currentAudio.play();
                if (playPromise !== undefined) {
                    playPromise.catch(error => {
                        console.error("Audio play failed:", error);
                        showAlert(`ì˜¤ë””ì˜¤ ì¬ìƒì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ${error.message}`);
                        onEnd();
                    });
                }
            };

            if (audioCache[text]) {
                playFromAudioObject(audioCache[text]);
                return;
            }

            try {
                // API í˜¸ì¶œ ë°©ì‹ì„ Vercel ì„œë²„ë¦¬ìŠ¤ í•¨ìˆ˜ë¥¼ í†µí•˜ë„ë¡ ìˆ˜ì •í•©ë‹ˆë‹¤.
                const response = await fetch('/api/gemini', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        action: 'tts', // 'tts' ì‘ì—…ì„ ìš”ì²­
                        text: text
                    })
                });


                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`API call failed: ${response.status} - ${errorText}`);
                }
                const result = await response.json();
                
                const audioContent = result?.candidates?.[0]?.content?.parts?.[0];
                const audioData = audioContent?.inlineData?.data;
                const mimeType = audioContent?.inlineData?.mimeType;

                if (audioData && mimeType) {
                    const sampleRateMatch = mimeType.match(/rate=(\d+)/);
                    const sampleRate = sampleRateMatch ? parseInt(sampleRateMatch[1], 10) : 24000;
                    
                    const pcmData = base64ToArrayBuffer(audioData);
                    const wavBlob = pcmToWav(new DataView(pcmData), sampleRate);
                    const audioUrl = URL.createObjectURL(wavBlob);
                    const newAudio = new Audio(audioUrl);
                    
                    newAudio.onerror = function() {
                        console.error("Audio format error.");
                        showAlert("ì˜¤ë””ì˜¤ íŒŒì¼ í˜•ì‹ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
                        buttonEl.classList.remove('is-playing');
                        if (currentPlayingButton === buttonEl) {
                           currentPlayingButton = null;
                        }
                    };

                    audioCache[text] = newAudio;
                    playFromAudioObject(newAudio);

                } else {
                    throw new Error("API ì‘ë‹µì— ì˜¤ë””ì˜¤ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.");
                }
            } catch (error) {
                console.error("TTS Error:", error);
                showAlert(`ìŒì„± ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}`);
                buttonEl.classList.remove('is-playing');
                currentPlayingButton = null;
            }
        }

        document.body.addEventListener('click', (e) => {
            const ttsButton = e.target.closest('.tts-btn');
            if (ttsButton) {
                const textElement = ttsButton.previousElementSibling;
                
                if (textElement && textElement.classList.contains('english-text')) {
                    const text = textElement.textContent.trim();
                    if (text) {
                        playAudio(text, ttsButton);
                    }
                }
            }
        });
        
        async function getNativeTranslation(text) {
            const systemPrompt = `You are an expert in Korean-English translation. Your role is to translate the user's Korean sentence into a natural, colloquial English sentence that a native speaker would use in everyday conversation. Your response must be in Korean and follow this structure exactly:
### ìì—°ìŠ¤ëŸ¬ìš´ í‘œí˜„
[Provide the most natural English sentence here]
#### ğŸ’¡ ì´ë ‡ê²Œ í‘œí˜„í•˜ëŠ” ì´ìœ 
[Provide a brief and clear explanation in Korean about why this expression is natural and used by native speakers.]`;

            try {
                // API í˜¸ì¶œ ë°©ì‹ì„ Vercel ì„œë²„ë¦¬ìŠ¤ í•¨ìˆ˜ë¥¼ í†µí•˜ë„ë¡ ìˆ˜ì •í•©ë‹ˆë‹¤.
                const response = await fetch('/api/gemini', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        action: 'translate', // 'translate' ì‘ì—…ì„ ìš”ì²­
                        text: text,
                        systemPrompt: systemPrompt
                    })
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    console.error("API Error:", errorText);
                    throw new Error(`API call failed: ${response.status} - ${errorText}`);
                }

                const result = await response.json();
                
                if (!result.candidates || result.candidates.length === 0 || !result.candidates[0].content?.parts?.[0]?.text) {
                     console.error("Invalid API response structure:", result);
                     throw new Error("API ì‘ë‹µì´ ë¹„ì–´ìˆê±°ë‚˜ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.");
                }
                return result.candidates[0].content.parts[0].text;
            } catch(error) {
                 console.error("Translation function error:", error);
                 throw error;
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            displayDate();
            initializeCounts();
            loadDailyPatterns();
            renderAllPatternsList();
        });
    </script>
</body>
</html>









